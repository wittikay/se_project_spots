!function(){"use strict";var e="";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit_inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},r=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);o.textContent="",o.classList.remove(r.errorClass),t.classList.remove(r.inputErrorClass)},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},n=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))};var a;function l(e,t){e?e.textContent=t:console.warn("Button element is not defined")}a=t,document.querySelectorAll(a.formSelector).forEach((e=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);n(o,a,t),o.forEach((l=>{l.addEventListener("input",(()=>{((e,t,o)=>{t.validity.valid?r(e,t,o):((e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);n.textContent=r,n.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)})(e,t,t.validationMessage,o)})(e,l,t),n(o,a,t)}))}))})(e,a)}));var d=e+"d3610e9c6dce3cb370d8.svg",c=e+"d73f076c46eb5467f5fc.svg",s=e+"2fc47fd8e9a9bcd9612f.jpg",i=e+"d38272e02bb4f1ab1c37.svg",u=e+"40608da7369d39bc1077.svg",m=e+"a8e301eb86866b1df117.svg",_=e+"53f0bab7ec2e970778f9.svg";let v,y=null,f=null;const b=document.getElementById("header__logo"),p=document.getElementById("profile__image"),S=document.getElementById("profile__image-btn-img"),g=document.getElementById("profile__edit-btn-img"),h=document.getElementById("profile__add-btn-img"),q=document.getElementById("modal__close-btn-img-avatar"),E=document.getElementById("modal__close-btn-img-delete"),L=document.getElementById("modal__close-btn-img-edit"),k=document.getElementById("modal__close-btn-img-add"),C=document.getElementById("modal__close-btn-img-whte"),I=document.querySelector(".cards__list"),B=document.getElementById("cards__template").content.querySelector(".card"),w=document.forms["edit-avatar-form"],A=document.querySelector(".profile__image-btn"),x=document.querySelector("#edit-avatar-modal .modal__submit-btn"),U=document.querySelector("#edit-avatar-modal"),D=document.querySelector("#edit-avatar-modal #link"),T=document.querySelector("#edit-avatar-modal .modal__close-btn"),$=document.querySelector(".profile__edit-btn"),N=document.querySelector("#edit-profile-modal"),P=N.querySelector(".modal__submit-btn"),j=document.querySelector("#edit-profile-modal .modal__close-btn"),O=document.forms["edit-profile"],J=document.querySelector(".profile__name"),H=document.querySelector(".profile__description"),M=document.querySelector("#edit-profile-modal #name"),R=document.querySelector("#edit-profile-modal #description"),z=document.querySelector(".profile__add-btn"),F=document.querySelector("#new-post-modal"),G=document.querySelector("#new-post-modal .modal__close-btn"),K=document.querySelector("#new-post-modal .modal__form"),Q=F.querySelector(".modal__submit-btn"),V=document.querySelector("#new-post-modal #link"),W=document.querySelector("#new-post-modal #caption"),X=document.querySelector("#delete-modal"),Y=document.querySelector(".modal__delSubmit-btn"),Z=document.querySelector(".modal__delCancel-btn"),ee=document.querySelector(".modal__delModal-close-btn"),te=document.getElementById("preview-modal"),re=document.querySelector("#preview-modal .modal__close-btn_preview"),oe=document.querySelector("#preview-modal .modal__image"),ne=document.querySelector("#preview-modal .modal__caption");b.src=d,p.src=s,S.src=c,q.src=m,E.src=_,L.src=m,k.src=m,g.src=i,h.src=u,C.src=_;const ae=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_handleResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t={}){return fetch(`${this._baseUrl}${e}`,{headers:this._headers,...t}).then(this._handleResponse)}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}getInitialCards(){return this._request("/cards")}getUserInfo(){return this._request("/users/me")}editUserInfo({name:e,about:t}){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})})}editAvatar({avatar:e}){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}addNewCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}changeLikeStatus(e,t){return this._request(`/cards/${e}/likes`,{method:t?"PUT":"DELETE"})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"43cc3865-d5d1-4d69-b4db-e6be73290a5f","Content-Type":"application/json"}});function le(e){e.target.classList.contains("modal_is-opened")&&se(e.target)}function de(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&se(e)}}const ce=e=>{e.classList.add("modal_is-opened"),document.addEventListener("keydown",de),e.addEventListener("click",le)},se=e=>{e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",de),e.removeEventListener("click",le)},ie=(e,t,r)=>{e.addEventListener("click",(()=>{r&&r(),ce(t)}))},ue=(e,t)=>{e.addEventListener("click",(()=>se(t)))};function me(e,t){const r=function(e){const t=B.cloneNode(!0);t.querySelector(".card__title").textContent=e.name;const r=t.querySelector(".card__image");r.alt=e.name,r.src=e.link;const o=t.querySelector(".card__like-btn");return e.isLiked?o.classList.add("card__like-btn_active"):o.classList.remove("card__like-btn_active"),o.addEventListener("click",(()=>function(e,t){const r=e.classList.contains("card__like-btn_active");ae.changeLikeStatus(t,!r).then((t=>{const r=t.isLiked;e.classList.toggle("card__like-btn_active",r)})).catch((e=>console.error("Error changing like status:",e)))}(o,e._id))),t.querySelector(".card__del-btn").addEventListener("click",(()=>function(e,t){y=e,f=t._id,ce(X)}(t,e))),r.addEventListener("click",(()=>function(e){oe.src=e.link,oe.alt=e.name,ne.textContent=e.name,ce(te)}(e))),t}(e);t.prepend(r)}Y.addEventListener("click",(function(e){e.preventDefault(),l(Y,"Deleting..."),ae.deleteCard(f).then((()=>{y.remove(),se(X),y=null,f=null})).catch((e=>console.error("Error deleting card:",e))).finally((()=>{l(Y,"Delete")}))})),w.addEventListener("submit",(function(e){e.preventDefault(),l(x,"Saving..."),ae.editAvatar({avatar:D.value}).then((e=>{p.src=e.avatar,se(U),w.reset(),o(x,t)})).catch((e=>console.error("Error updating avatar:",e))).finally((()=>{l(x,"Save")}))})),ie(A,U,(()=>{Array.from(U.querySelectorAll(t.inputSelector))})),ue(T,U),ie($,N,(()=>{M.value=J.textContent,R.value=H.textContent,((e,t,o)=>{t.forEach((t=>{r(e,t,o)}))})(O,Array.from(O.querySelectorAll(t.inputSelector)),t)})),ue(j,N),ie(z,F,(()=>{K.querySelector(t.submitButtonSelector)})),ue(G,F),ue(ee,X),ue(Z,X),ue(re,te),O.addEventListener("submit",(e=>{e.preventDefault(),l(P,"Saving..."),ae.editUserInfo({name:M.value,about:R.value}).then((e=>{p.src=e.avatar,J.textContent=e.name,H.textContent=e.about,o(P,t),se(N)})).catch((e=>console.error("Error updating user info:",e))).finally((()=>{l(P,"Save")}))})),K.addEventListener("submit",(e=>{e.preventDefault(),l(Q,"Saving..."),ae.addNewCard({name:W.value,link:V.value}).then((e=>{me(e,I),K.reset(),o(Q,t),se(F)})).catch((e=>console.error("Error adding new card:",e))).finally((()=>{l(Q,"Save")}))})),ae.getAppInfo().then((([e,t])=>{v=e._id,J.textContent=e.name,H.textContent=e.about,p.src=e.avatar,t.forEach((e=>me(e,I)))})).catch((e=>console.error("Error fetching initial data:",e)))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TTJELElBQ0xoSSxFQUFXMkMsSUFBTXFGLEVBQUs5QyxPQUN0QjFELEVBQVkxRCxZQUFja0ssRUFBS3JELEtBQy9CbEQsRUFBbUIzRCxZQUFja0ssRUFBS3BELE1BQ3RDM0csRUFBV29ELEVBQWtCckUsR0FDN0I4SSxHQUFXMUUsTUFFWmdHLE9BQU9DLEdBQVF2SSxRQUFRd0ksTUFBTSw0QkFBNkJELEtBQzFEUyxTQUFRLEtBQ1BuSixFQUFjMEMsRUFBa0IsY0FJdENVLEVBQWV6QyxpQkFBaUIsVUFBV3FHLElBQ3pDQSxFQUFJa0MsaUJBRUpsSixFQUFjcUQsRUFBaUIsYUFDL0JtQixHQUNHZ0MsV0FBVyxDQUNWUixLQUFNekMsRUFBa0I2RixNQUN4QjNDLEtBQU1uRCxFQUFlOEYsUUFFdEIxRCxNQUFNNEMsSUFDTFIsR0FBV1EsRUFBTXhHLEdBQ2pCc0IsRUFBZWtHLFFBQ2ZoSyxFQUFXK0QsRUFBaUJoRixHQUM1QjhJLEdBQVdqRSxNQUVadUYsT0FBT0MsR0FBUXZJLFFBQVF3SSxNQUFNLHlCQUEwQkQsS0FDdkRTLFNBQVEsS0FDUG5KLEVBQWNxRCxFQUFpQixjQUlyQ21CLEdBQ0dtQixhQUNBRCxNQUFLLEVBQUUyRCxFQUFNRyxNQUNaeEksRUFBZ0JxSSxFQUFLUixJQUNyQmhHLEVBQVkxRCxZQUFja0ssRUFBS3JELEtBQy9CbEQsRUFBbUIzRCxZQUFja0ssRUFBS3BELE1BQ3RDNUUsRUFBVzJDLElBQU1xRixFQUFLOUMsT0FDdEJpRCxFQUFNakosU0FBUytILEdBQVNSLEdBQVdRLEVBQU14RyxRQUUxQzJHLE9BQU9DLEdBQVF2SSxRQUFRd0ksTUFBTSwrQkFBZ0NELEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIl9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7IiwiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idG5cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0X2luYWN0aXZlXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvclwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBlcnJvck1zZywgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IGVycm9yTXNnO1xuICBlcnJvck1zZ0VsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQ2xhc3MpOyAvLyBBZGQgdGhlIGVycm9yIGNsYXNzIHRvIHRoZSBlcnJvciBtZXNzYWdlXG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTsgLy8gQWRkIHRoZSBlcnJvciBjbGFzcyB0byB0aGUgaW5wdXRcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IFwiXCI7IC8vIENsZWFyIHRoZSBlcnJvciBtZXNzYWdlXG4gIGVycm9yTXNnRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuZXJyb3JDbGFzcyk7IC8vIFJlbW92ZSB0aGUgZXJyb3IgY2xhc3MgZnJvbSB0aGUgZXJyb3IgbWVzc2FnZVxuICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7IC8vIFJlbW92ZSB0aGUgZXJyb3IgY2xhc3MgZnJvbSB0aGUgaW5wdXRcbn07XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xuICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICB9XG59O1xuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGkpID0+IHtcbiAgcmV0dXJuIGlucHV0TGkuc29tZSgoaW5wdXRFbCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXRFbC52YWxpZGl0eS52YWxpZDtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZGlzYWJsZUJ0biA9IChidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG59O1xuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaSwgYnV0dG9uRWwsIGNvbmZpZykgPT4ge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGkpKSB7XG4gICAgZGlzYWJsZUJ0bihidXR0b25FbCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGJ1dHRvbkVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaSA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWwgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpLCBidXR0b25FbCwgY29uZmlnKTtcbiAgaW5wdXRMaS5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGksIGJ1dHRvbkVsLCBjb25maWcpO1xuICAgIH0pO1xuICB9KTtcbn07XG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKTtcbiAgZm9ybUxpLmZvckVhY2goKGZvcm1FbCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKTtcbiAgfSk7XG59O1xuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWwsIGlucHV0TGksIGNvbmZpZykgPT4ge1xuICBpbnB1dExpLmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH0pO1xufTtcbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuXG4iLCJleHBvcnQgZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChidXR0b24sIHRleHQpIHtcbiAgaWYgKGJ1dHRvbikge1xuICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKFwiQnV0dG9uIGVsZW1lbnQgaXMgbm90IGRlZmluZWRcIik7XG4gIH1cbn1cbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgeyBBcGkgfSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdG4sXG4gIHNldHRpbmdzLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcbmltcG9ydCBoZWFkZXJMb2dvU3JjIGZyb20gXCIuLi9pbWFnZXMvTG9nby5zdmdcIjtcbmltcG9ydCBwcm9maWxlQXZhdGFyUGVuY2lsU3JjIGZyb20gXCIuLi9pbWFnZXMvcGVuY2lsLXdodGUuc3ZnXCI7XG5pbXBvcnQgcHJvZmlsZUltZ1NyYyBmcm9tIFwiLi4vaW1hZ2VzL2F2YXRhci5qcGdcIjtcbmltcG9ydCBwcm9maWxlRWRpdEltZ1NyYyBmcm9tIFwiLi4vaW1hZ2VzL0dyb3VwLTIuc3ZnXCI7XG5pbXBvcnQgcHJvZmlsZUFkZEltZ1NyYyBmcm9tIFwiLi4vaW1hZ2VzL0dyb3VwLTI2LnN2Z1wiO1xuaW1wb3J0IG1vZGFsQmxhY2tYU3JjIGZyb20gXCIuLi9pbWFnZXMvY2xvc2UtaWNvbmJsay5zdmdcIjtcbmltcG9ydCBtb2RhbFdoaXRlWFNyYyBmcm9tIFwiLi4vaW1hZ2VzL2Nsb3NlLWljb253aHQuc3ZnXCI7XG5cbmxldCBjdXJyZW50VXNlcklkO1xubGV0IHNlbGVjdGVkQ2FyZCA9IG51bGwsXG4gIHNlbGVjdGVkQ2FyZElkID0gbnVsbDtcblxuY29uc3QgaGVhZGVyTG9nbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaGVhZGVyX19sb2dvXCIpO1xuY29uc3QgcHJvZmlsZUltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJvZmlsZV9faW1hZ2VcIik7XG5jb25zdCBwcm9maWxlQXZhdGFyUGVuY2lsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9maWxlX19pbWFnZS1idG4taW1nXCIpO1xuY29uc3QgcHJvZmlsZUVkaXRJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInByb2ZpbGVfX2VkaXQtYnRuLWltZ1wiKTtcbmNvbnN0IHByb2ZpbGVBZGRJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInByb2ZpbGVfX2FkZC1idG4taW1nXCIpO1xuY29uc3QgYXZhdGFyTW9kYWxCbGFja1ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgXCJtb2RhbF9fY2xvc2UtYnRuLWltZy1hdmF0YXJcIlxuKTtcbmNvbnN0IGRlbGV0ZU1vZGFsV2hpdGVYID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gIFwibW9kYWxfX2Nsb3NlLWJ0bi1pbWctZGVsZXRlXCJcbik7XG5jb25zdCBlZGl0TW9kYWxCbGFja1ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vZGFsX19jbG9zZS1idG4taW1nLWVkaXRcIik7XG5jb25zdCBhZGRNb2RhbEJsYWNrWCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibW9kYWxfX2Nsb3NlLWJ0bi1pbWctYWRkXCIpO1xuY29uc3QgbW9kYWxXaGl0ZVggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vZGFsX19jbG9zZS1idG4taW1nLXdodGVcIik7XG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnRcbiAgLmdldEVsZW1lbnRCeUlkKFwiY2FyZHNfX3RlbXBsYXRlXCIpXG4gIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcbmNvbnN0IGF2YXRhckVkaXRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJlZGl0LWF2YXRhci1mb3JtXCJdO1xuY29uc3QgYXZhdGFyRWRpdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2UtYnRuXCIpO1xuY29uc3QgYXZhdGFyRWRpdFNhdmVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNlZGl0LWF2YXRhci1tb2RhbCAubW9kYWxfX3N1Ym1pdC1idG5cIlxuKTtcbmNvbnN0IGF2YXRhckVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJFZGl0SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLW1vZGFsICNsaW5rXCIpO1xuY29uc3QgYXZhdGFyQ2xvc2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNlZGl0LWF2YXRhci1tb2RhbCAubW9kYWxfX2Nsb3NlLWJ0blwiXG4pO1xuY29uc3QgcHJvZmlsZUVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuY29uc3QgcHJvZmlsZUVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xuY29uc3QgZWRpdE1vZGFsU2F2ZUJ0biA9IHByb2ZpbGVFZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcbmNvbnN0IGNsb3NlRWRpdE1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIjZWRpdC1wcm9maWxlLW1vZGFsIC5tb2RhbF9fY2xvc2UtYnRuXCJcbik7XG5jb25zdCBlZGl0UHJvZmlsZUZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtcHJvZmlsZVwiXTtcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsICNuYW1lXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI2VkaXQtcHJvZmlsZS1tb2RhbCAjZGVzY3JpcHRpb25cIlxuKTtcbmNvbnN0IHByb2ZpbGVBZGRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XG5jb25zdCBwcm9maWxlQWRkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgY2xvc2VBZGRNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI25ldy1wb3N0LW1vZGFsIC5tb2RhbF9fY2xvc2UtYnRuXCJcbik7XG5jb25zdCBwcm9maWxlQWRkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWwgLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgYWRkTW9kYWxTYXZlQnRuID0gcHJvZmlsZUFkZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBwcm9maWxlQWRkTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWwgI2xpbmtcIik7XG5jb25zdCBwcm9maWxlQWRkQ2FwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWwgI2NhcHRpb25cIik7XG5jb25zdCBkZWxldGVQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IHN1Ym1pdERlbGV0ZVBvc3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19kZWxTdWJtaXQtYnRuXCIpO1xuY29uc3QgY2FuY2VsRGVsZXRlUG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2RlbENhbmNlbC1idG5cIik7XG5jb25zdCBjbG9zZURlbGV0ZVBvc3RNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19kZWxNb2RhbC1jbG9zZS1idG5cIlxuKTtcbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IGNsb3NlUHJldmlld01vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJldmlldy1tb2RhbCAubW9kYWxfX2Nsb3NlLWJ0bl9wcmV2aWV3XCJcbik7XG5jb25zdCBwcmV2aWV3SW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWwgLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdDYXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsIC5tb2RhbF9fY2FwdGlvblwiKTtcblxuKGZ1bmN0aW9uIHNldEltYWdlU291cmNlcygpIHtcbiAgaGVhZGVyTG9nby5zcmMgPSBoZWFkZXJMb2dvU3JjO1xuICBwcm9maWxlSW1nLnNyYyA9IHByb2ZpbGVJbWdTcmM7XG4gIHByb2ZpbGVBdmF0YXJQZW5jaWwuc3JjID0gcHJvZmlsZUF2YXRhclBlbmNpbFNyYztcbiAgYXZhdGFyTW9kYWxCbGFja1guc3JjID0gbW9kYWxCbGFja1hTcmM7XG4gIGRlbGV0ZU1vZGFsV2hpdGVYLnNyYyA9IG1vZGFsV2hpdGVYU3JjO1xuICBlZGl0TW9kYWxCbGFja1guc3JjID0gbW9kYWxCbGFja1hTcmM7XG4gIGFkZE1vZGFsQmxhY2tYLnNyYyA9IG1vZGFsQmxhY2tYU3JjO1xuICBwcm9maWxlRWRpdEltZy5zcmMgPSBwcm9maWxlRWRpdEltZ1NyYztcbiAgcHJvZmlsZUFkZEltZy5zcmMgPSBwcm9maWxlQWRkSW1nU3JjO1xuICBtb2RhbFdoaXRlWC5zcmMgPSBtb2RhbFdoaXRlWFNyYztcbn0pKCk7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjQzY2MzODY1LWQ1ZDEtNGQ2OS1iNGRiLWU2YmU3MzI5MGE1ZlwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmZ1bmN0aW9uIGhhbmRsZU92ZXJsYXlDbGljayhldnQpIHtcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfaXMtb3BlbmVkXCIpKSB7XG4gICAgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVFc2NLZXkoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICB9XG59XG5cbmNvbnN0IG9wZW5Nb2RhbCA9IChtb2RhbCkgPT4ge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NLZXkpO1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlT3ZlcmxheUNsaWNrKTtcbn07XG5cbmNvbnN0IGNsb3NlTW9kYWwgPSAobW9kYWwpID0+IHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjS2V5KTtcbiAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU92ZXJsYXlDbGljayk7XG59O1xuXG5jb25zdCBhZGRPcGVuTW9kYWxMaXN0ZW5lciA9ICh0cmlnZ2VyLCBtb2RhbCwgY2IpID0+IHtcbiAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGlmIChjYikgY2IoKTtcbiAgICBvcGVuTW9kYWwobW9kYWwpO1xuICB9KTtcbn07XG5cbmNvbnN0IGFkZENsb3NlTW9kYWxMaXN0ZW5lciA9IChidXR0b24sIG1vZGFsKSA9PiB7XG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChtb2RhbCkpO1xufTtcblxuZnVuY3Rpb24gaGFuZGxlTGlrZUNsaWNrKGxpa2VCdG4sIGNhcmRJZCkge1xuICBjb25zdCBpc0xpa2VkID0gbGlrZUJ0bi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIik7XG4gIGFwaVxuICAgIC5jaGFuZ2VMaWtlU3RhdHVzKGNhcmRJZCwgIWlzTGlrZWQpXG4gICAgLnRoZW4oKGNhcmQpID0+IHtcbiAgICAgIGNvbnN0IGlzTm93TGlrZWQgPSBjYXJkLmlzTGlrZWQ7XG4gICAgICBsaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIiwgaXNOb3dMaWtlZCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihcIkVycm9yIGNoYW5naW5nIGxpa2Ugc3RhdHVzOlwiLCBlcnIpKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIikudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNvbnN0IGNhcmRJbWFnZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNhcmRJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gIGNvbnN0IGxpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgbGlrZUJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICB9IGVsc2Uge1xuICAgIGxpa2VCdG4uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcbiAgfVxuICBsaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBoYW5kbGVMaWtlQ2xpY2sobGlrZUJ0biwgZGF0YS5faWQpKTtcbiAgY2FyZEVsZW1lbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWwtYnRuXCIpXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBoYW5kbGVEZWxDYXJkKGNhcmRFbGVtZW50LCBkYXRhKSk7XG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gb3BlblByZXZpZXdNb2RhbChkYXRhKSk7XG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuZnVuY3Rpb24gcmVuZGVyQ2FyZChkYXRhLCBjb250YWluZXIpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcbiAgY29udGFpbmVyLnByZXBlbmQoY2FyZEVsZW1lbnQpO1xufVxuXG5mdW5jdGlvbiBvcGVuUHJldmlld01vZGFsKGRhdGEpIHtcbiAgcHJldmlld0ltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgcHJldmlld0ltYWdlLmFsdCA9IGRhdGEubmFtZTtcbiAgcHJldmlld0NhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxDYXJkKGNhcmRFbGVtZW50LCBkYXRhKSB7XG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xuICBvcGVuTW9kYWwoZGVsZXRlUG9zdE1vZGFsKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRGVsU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXREZWxldGVQb3N0QnRuLCBcIkRlbGV0aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZVBvc3RNb2RhbCk7XG4gICAgICBzZWxlY3RlZENhcmQgPSBudWxsO1xuICAgICAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBjYXJkOlwiLCBlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0RGVsZXRlUG9zdEJ0biwgXCJEZWxldGVcIik7XG4gICAgfSk7XG59XG5zdWJtaXREZWxldGVQb3N0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVEZWxTdWJtaXQpO1xuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJFZGl0U2F2ZShldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIHNldEJ1dHRvblRleHQoYXZhdGFyRWRpdFNhdmVCdG4sIFwiU2F2aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZWRpdEF2YXRhcih7IGF2YXRhcjogYXZhdGFyRWRpdElucHV0LnZhbHVlIH0pXG4gICAgLnRoZW4oKHVzZXIpID0+IHtcbiAgICAgIHByb2ZpbGVJbWcuc3JjID0gdXNlci5hdmF0YXI7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhckVkaXRNb2RhbCk7XG4gICAgICBhdmF0YXJFZGl0Rm9ybS5yZXNldCgpO1xuICAgICAgZGlzYWJsZUJ0bihhdmF0YXJFZGl0U2F2ZUJ0biwgc2V0dGluZ3MpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBhdmF0YXI6XCIsIGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChhdmF0YXJFZGl0U2F2ZUJ0biwgXCJTYXZlXCIpO1xuICAgIH0pO1xufVxuYXZhdGFyRWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJFZGl0U2F2ZSk7XG5cbmFkZE9wZW5Nb2RhbExpc3RlbmVyKGF2YXRhckVkaXRCdG4sIGF2YXRhckVkaXRNb2RhbCwgKCkgPT4ge1xuICBhdmF0YXJFZGl0TW9kYWwsXG4gICAgQXJyYXkuZnJvbShhdmF0YXJFZGl0TW9kYWwucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSksXG4gICAgc2V0dGluZ3M7XG59KTtcbmFkZENsb3NlTW9kYWxMaXN0ZW5lcihhdmF0YXJDbG9zZUJ0biwgYXZhdGFyRWRpdE1vZGFsKTtcblxuYWRkT3Blbk1vZGFsTGlzdGVuZXIocHJvZmlsZUVkaXRCdG4sIHByb2ZpbGVFZGl0TW9kYWwsICgpID0+IHtcbiAgZWRpdFByb2ZpbGVOYW1lLnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XG4gIGVkaXRQcm9maWxlRGVzY3JpcHRpb24udmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBlZGl0UHJvZmlsZUZvcm0sXG4gICAgQXJyYXkuZnJvbShlZGl0UHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSksXG4gICAgc2V0dGluZ3NcbiAgKTtcbn0pO1xuYWRkQ2xvc2VNb2RhbExpc3RlbmVyKGNsb3NlRWRpdE1vZGFsQnRuLCBwcm9maWxlRWRpdE1vZGFsKTtcblxuYWRkT3Blbk1vZGFsTGlzdGVuZXIocHJvZmlsZUFkZEJ0biwgcHJvZmlsZUFkZE1vZGFsLCAoKSA9PiB7XG4gIHByb2ZpbGVBZGRGb3JtLnF1ZXJ5U2VsZWN0b3Ioc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3IpLCBzZXR0aW5ncztcbn0pO1xuYWRkQ2xvc2VNb2RhbExpc3RlbmVyKGNsb3NlQWRkTW9kYWxCdG4sIHByb2ZpbGVBZGRNb2RhbCk7XG5cbmFkZENsb3NlTW9kYWxMaXN0ZW5lcihjbG9zZURlbGV0ZVBvc3RNb2RhbEJ0biwgZGVsZXRlUG9zdE1vZGFsKTtcbmFkZENsb3NlTW9kYWxMaXN0ZW5lcihjYW5jZWxEZWxldGVQb3N0QnRuLCBkZWxldGVQb3N0TW9kYWwpO1xuYWRkQ2xvc2VNb2RhbExpc3RlbmVyKGNsb3NlUHJldmlld01vZGFsQnRuLCBwcmV2aWV3TW9kYWwpO1xuXG5lZGl0UHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBzZXRCdXR0b25UZXh0KGVkaXRNb2RhbFNhdmVCdG4sIFwiU2F2aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IGVkaXRQcm9maWxlTmFtZS52YWx1ZSxcbiAgICAgIGFib3V0OiBlZGl0UHJvZmlsZURlc2NyaXB0aW9uLnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKHVzZXIpID0+IHtcbiAgICAgIHByb2ZpbGVJbWcuc3JjID0gdXNlci5hdmF0YXI7XG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXIuYWJvdXQ7XG4gICAgICBkaXNhYmxlQnRuKGVkaXRNb2RhbFNhdmVCdG4sIHNldHRpbmdzKTtcbiAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUVkaXRNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIHVzZXIgaW5mbzpcIiwgZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KGVkaXRNb2RhbFNhdmVCdG4sIFwiU2F2ZVwiKTtcbiAgICB9KTtcbn0pO1xuXG5wcm9maWxlQWRkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgc2V0QnV0dG9uVGV4dChhZGRNb2RhbFNhdmVCdG4sIFwiU2F2aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuYWRkTmV3Q2FyZCh7XG4gICAgICBuYW1lOiBwcm9maWxlQWRkQ2FwdGlvbi52YWx1ZSxcbiAgICAgIGxpbms6IHByb2ZpbGVBZGRMaW5rLnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGNhcmQpID0+IHtcbiAgICAgIHJlbmRlckNhcmQoY2FyZCwgY2FyZHNMaXN0KTtcbiAgICAgIHByb2ZpbGVBZGRGb3JtLnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnRuKGFkZE1vZGFsU2F2ZUJ0biwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChwcm9maWxlQWRkTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhZGRpbmcgbmV3IGNhcmQ6XCIsIGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChhZGRNb2RhbFNhdmVCdG4sIFwiU2F2ZVwiKTtcbiAgICB9KTtcbn0pO1xuXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW3VzZXIsIGNhcmRzXSkgPT4ge1xuICAgIGN1cnJlbnRVc2VySWQgPSB1c2VyLl9pZDtcbiAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcbiAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VyLmFib3V0O1xuICAgIHByb2ZpbGVJbWcuc3JjID0gdXNlci5hdmF0YXI7XG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4gcmVuZGVyQ2FyZChjYXJkLCBjYXJkc0xpc3QpKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBpbml0aWFsIGRhdGE6XCIsIGVycikpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9oYW5kbGVSZXNwb25zZShyZXMpIHtcbiAgICByZXR1cm4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICB9XG5cbiAgX3JlcXVlc3QoZW5kcG9pbnQsIG9wdGlvbnMgPSB7fSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfSR7ZW5kcG9pbnR9YCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSk7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VySW5mbygpLCB0aGlzLmdldEluaXRpYWxDYXJkcygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoXCIvY2FyZHNcIik7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi91c2Vycy9tZVwiKTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi91c2Vycy9tZVwiLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgYWJvdXQgfSksXG4gICAgfSk7XG4gIH1cblxuICBlZGl0QXZhdGFyKHsgYXZhdGFyIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi91c2Vycy9tZS9hdmF0YXJcIiwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhciB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGFkZE5ld0NhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi9jYXJkc1wiLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBsaW5rIH0pLFxuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoY2FyZElkLCBpc0xpa2VkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIlBVVFwiIDogXCJERUxFVEVcIixcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgeyBBcGkgfTtcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsImVycm9yTXNnRWwiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImRpc2FibGVCdG4iLCJidXR0b25FbCIsImRpc2FibGVkIiwiYWRkIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpIiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJzZXRCdXR0b25UZXh0IiwiYnV0dG9uIiwidGV4dCIsImNvbnNvbGUiLCJ3YXJuIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImN1cnJlbnRVc2VySWQiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImhlYWRlckxvZ28iLCJnZXRFbGVtZW50QnlJZCIsInByb2ZpbGVJbWciLCJwcm9maWxlQXZhdGFyUGVuY2lsIiwicHJvZmlsZUVkaXRJbWciLCJwcm9maWxlQWRkSW1nIiwiYXZhdGFyTW9kYWxCbGFja1giLCJkZWxldGVNb2RhbFdoaXRlWCIsImVkaXRNb2RhbEJsYWNrWCIsImFkZE1vZGFsQmxhY2tYIiwibW9kYWxXaGl0ZVgiLCJjYXJkc0xpc3QiLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiYXZhdGFyRWRpdEZvcm0iLCJmb3JtcyIsImF2YXRhckVkaXRCdG4iLCJhdmF0YXJFZGl0U2F2ZUJ0biIsImF2YXRhckVkaXRNb2RhbCIsImF2YXRhckVkaXRJbnB1dCIsImF2YXRhckNsb3NlQnRuIiwicHJvZmlsZUVkaXRCdG4iLCJwcm9maWxlRWRpdE1vZGFsIiwiZWRpdE1vZGFsU2F2ZUJ0biIsImNsb3NlRWRpdE1vZGFsQnRuIiwiZWRpdFByb2ZpbGVGb3JtIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJlZGl0UHJvZmlsZU5hbWUiLCJlZGl0UHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZUFkZEJ0biIsInByb2ZpbGVBZGRNb2RhbCIsImNsb3NlQWRkTW9kYWxCdG4iLCJwcm9maWxlQWRkRm9ybSIsImFkZE1vZGFsU2F2ZUJ0biIsInByb2ZpbGVBZGRMaW5rIiwicHJvZmlsZUFkZENhcHRpb24iLCJkZWxldGVQb3N0TW9kYWwiLCJzdWJtaXREZWxldGVQb3N0QnRuIiwiY2FuY2VsRGVsZXRlUG9zdEJ0biIsImNsb3NlRGVsZXRlUG9zdE1vZGFsQnRuIiwicHJldmlld01vZGFsIiwiY2xvc2VQcmV2aWV3TW9kYWxCdG4iLCJwcmV2aWV3SW1hZ2UiLCJwcmV2aWV3Q2FwdGlvbiIsInNyYyIsImhlYWRlckxvZ29TcmMiLCJwcm9maWxlSW1nU3JjIiwicHJvZmlsZUF2YXRhclBlbmNpbFNyYyIsIm1vZGFsQmxhY2tYU3JjIiwibW9kYWxXaGl0ZVhTcmMiLCJwcm9maWxlRWRpdEltZ1NyYyIsInByb2ZpbGVBZGRJbWdTcmMiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfaGFuZGxlUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiX3JlcXVlc3QiLCJlbmRwb2ludCIsIm9wdGlvbnMiLCJmZXRjaCIsInRoZW4iLCJnZXRBcHBJbmZvIiwiYWxsIiwiZ2V0VXNlckluZm8iLCJnZXRJbml0aWFsQ2FyZHMiLCJlZGl0VXNlckluZm8iLCJuYW1lIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRBdmF0YXIiLCJhdmF0YXIiLCJhZGROZXdDYXJkIiwibGluayIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJjaGFuZ2VMaWtlU3RhdHVzIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJoYW5kbGVPdmVybGF5Q2xpY2siLCJldnQiLCJ0YXJnZXQiLCJjb250YWlucyIsImNsb3NlTW9kYWwiLCJoYW5kbGVFc2NLZXkiLCJrZXkiLCJvcGVuZWRNb2RhbCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZE9wZW5Nb2RhbExpc3RlbmVyIiwidHJpZ2dlciIsImNiIiwiYWRkQ2xvc2VNb2RhbExpc3RlbmVyIiwicmVuZGVyQ2FyZCIsImRhdGEiLCJjb250YWluZXIiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImNhcmRJbWFnZSIsImFsdCIsImxpa2VCdG4iLCJjYXJkIiwiaXNOb3dMaWtlZCIsInRvZ2dsZSIsImNhdGNoIiwiZXJyIiwiZXJyb3IiLCJoYW5kbGVMaWtlQ2xpY2siLCJfaWQiLCJoYW5kbGVEZWxDYXJkIiwib3BlblByZXZpZXdNb2RhbCIsImdldENhcmRFbGVtZW50IiwicHJlcGVuZCIsInByZXZlbnREZWZhdWx0IiwiZmluYWxseSIsInZhbHVlIiwidXNlciIsInJlc2V0IiwicmVzZXRWYWxpZGF0aW9uIiwiY2FyZHMiXSwic291cmNlUm9vdCI6IiJ9